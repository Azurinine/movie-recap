<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Episode Search</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <div class="container">
    <h1>Search Episodes</h1>
    
    <input type="text" id="showTitleInput" placeholder="Enter Show Title" />
    <input type="number" id="seasonNumberInput" placeholder="Enter Season Number" />
    <button onclick="performSearch()">Search</button>
    
    <div id="episodesList" class="episodes-list"></div>
  </div>

  <script>
    function performSearch() {
      const title = document.getElementById("showTitleInput").value;
      const season = document.getElementById("seasonNumberInput").value;
      const resultContainer = document.getElementById("episodesList");
      
      // Input validation
      if (!title || !season) {
        resultContainer.innerHTML = '<p class="error">Please enter both show title and season number.</p>';
        return;
      }

      // Show loading state
      resultContainer.innerHTML = '<p>Loading...</p>';

      fetch(`/api/search?title=${encodeURIComponent(title)}&season=${encodeURIComponent(season)}`)
        .then(res => {
          if (!res.ok) {
            throw new Error(`HTTP error! status: ${res.status}`);
          }
          return res.json();
        })
        .then(episodes => {
          console.log('Episodes:', episodes); // Add this line
          resultContainer.innerHTML = '';

          if (!Array.isArray(episodes) || episodes.length === 0) {
            resultContainer.innerHTML = '<p>No episodes found.</p>';
            return;
          }

          const episodesHTML = episodes
            .map(ep => `
              <div class="episode">
                <h2>${ep.name || 'Untitled'} (Episode ${ep.number || 'N/A'})</h2>
                <p><strong>Rating:</strong> ${ep.rating || 'N/A'}</p>
              </div>
            `)
            .join('');

          resultContainer.innerHTML = episodesHTML;
        })
        .catch(err => {
          resultContainer.innerHTML = `
            <p class="error">
              Error: ${err.message || 'Something went wrong. Please try again.'}
            </p>
          `;
          console.error('Search error:', err);
        });
    }
  </script>

</body>
</html>
